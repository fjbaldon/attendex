<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8"/>
    <title th:text="${reportTitle}">Attendance Report</title>

    <style>
        /* --- STATIC STYLES --- */

        /* Layout and Header */
        .header-table {
            width: 100%;
            margin-bottom: 5mm;
            border-bottom: 2px solid #2F2F2F;
            padding-bottom: 2mm;
        }
        .header-table td { border-bottom: none; padding: 0; vertical-align: middle; }
        .logo { height: 24px; width: 24px; vertical-align: middle; margin-right: 8px; }
        .app-name { font-weight: bold; font-size: 1.2em; color: #2F2F2F; vertical-align: middle; }
        .header-right { text-align: right; vertical-align: bottom; }
        .org-name { font-weight: bold; color: #000; font-size: 1.1em; }
        .report-meta { color: #666; font-size: 0.9em; }

        .title-section { margin-bottom: 5mm; }
        h1 { font-size: 1.8em; margin: 0 0 2mm 0; font-weight: bold; }
        .stats-bar { font-size: 1em; color: #555; }

        /* Table Structure */
        table.data-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        /* Generic Cell Styling */
        table.data-table th, table.data-table td {
            vertical-align: top;
        }

        /* Header Specifics */
        table.data-table th {
            border-bottom: 2px solid #000;
            font-weight: bold;
            text-transform: uppercase;
            color: #000;
            overflow: hidden;
            white-space: nowrap;
        }

        /* Row Specifics */
        table.data-table td {
            border-bottom: 1px solid #eee;
            word-wrap: break-word;
            white-space: normal;
        }

        /* --- COLUMN WIDTHS AND ALIGNMENT --- */
        /* Changed ampersand to 'AND' to prevent XML parse error */

        /* 1. Identity (Left) */
        .col-identity {
            width: 12%;
            text-align: left;
        }

        /* 2. Names (Left) */
        .col-name {
            width: 13%;
            text-align: left;
        }

        /* 3. Status (Left, No Wrap) */
        .col-status {
            width: 12%;
            text-align: left;
            white-space: nowrap;
        }

        /* 4. Time (Right, No Wrap) */
        .col-time {
            width: 15%;
            text-align: right;
            white-space: nowrap;
        }

        /* Badge Style */
        .status-badge { font-weight: bold; color: #444; }
    </style>

    <!-- Dynamic CSS from Java (Page Size, Font Size, Padding) -->
    <style th:utext="${customCss}"></style>
</head>
<body>

<!-- Header Table -->
<table class="header-table">
    <tr>
        <td>
            <img th:src="${logoData}" class="logo" alt="Logo" />
            <span class="app-name">AttendEx</span>
        </td>
        <td class="header-right">
            <div class="org-name" th:text="${organizationName}">Organization Name</div>
            <div class="report-meta">Generated: <span th:text="${generatedDate}">Date</span></div>
        </td>
    </tr>
</table>

<!-- Title & Stats -->
<div class="title-section">
    <h1 th:text="${eventName}">Event Name</h1>
    <div class="stats-bar">
        Report: <strong th:text="${reportTitle}">Attendance Log</strong> &#160;|&#160;
        Total Records: <strong th:text="${totalCount}">0</strong>
    </div>
</div>

<!-- Data Table -->
<table class="data-table">
    <thead>
    <tr>
        <th class="col-identity">Identity</th>
        <th class="col-name">Last Name</th>
        <th class="col-name">First Name</th>

        <!-- Dynamic Headers -->
        <th th:each="header : ${attributeHeaders}"
            th:text="${header}"
            style="text-align: left;">Attribute</th>

        <th class="col-status">Status</th>

        <th class="col-time">Time</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="entry : ${entries}">
        <td class="col-identity" th:text="${entry.attendee.identity}">ID</td>
        <td class="col-name" th:text="${entry.attendee.lastName}">Doe</td>
        <td class="col-name" th:text="${entry.attendee.firstName}">John</td>

        <!-- Dynamic Values -->
        <td th:each="header : ${attributeHeaders}">
            <span th:text="${entry.attendee.attributes != null ? entry.attendee.attributes.get(header) : ''}"></span>
        </td>

        <td class="col-status">
            <span class="status-badge"
                  th:text="${#strings.capitalize(#strings.toLowerCase(entry.punctuality))}">
                Punctual
            </span>
        </td>

        <td class="col-time"
            th:text="${#temporals.format(entry.scanTimestamp, 'h:mm:ss a')}">10:00 AM
        </td>
    </tr>
    </tbody>
</table>

</body>
</html>
